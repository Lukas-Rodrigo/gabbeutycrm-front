<app-primary-button
  (click)="showDialog()"
  [primaryHover]="true"
  buttonTitle="Agendamento"
  iconTitle="pi pi-calendar-plus"
/>

<p-dialog
  [(visible)]="visible"
  [baseZIndex]="10000"
  [closable]="true"
  [dismissableMask]="true"
  [draggable]="false"
  [modal]="true"
  [style]="{ width: '48rem', height: '52rem' }"
  styleClass="bg-[#f9faff]! relative!"
>

  <ng-template #header>
    <div>
      <h1 class="text-2xl font-semibold">Agendar cliente</h1>
      <span class="text-muted-color">Informe os dados para realizar um novo agendamento</span>
    </div>
  </ng-template>


  <div class="grid grid-cols-2 gap-5">
    <div class="bg-primary-contrast p-3 rounded-lg">
      <p-stepper [(value)]="activeStep">
        <p-step-list class="text-sm!">
          <p-step [value]="1" class="flex flex-row flex-auto gap-2 p-0!">
            <ng-template #content let-activateCallback="activateCallback"
                         let-value="value">
              <button
                (click)="activateCallback()"
                class="bg-transparent cursor-pointer border-0 inline-flex flex-col gap-2">
                    <span
                      [ngClass]="{
                                'bg-primary text-primary-contrast border-primary': value <= activeStep,
                                'border-surface': value > activeStep
                            }"
                      class="rounded-full border-2  w-8 h-8 inline-flex items-center justify-center"
                    >
                        <i class="pi pi-clock"></i>
                    </span>
              </button>
            </ng-template>
          </p-step>

          <p-step [value]="2" class="flex flex-row flex-auto gap-2"
                  [disabled]="!formValidated()">
            <ng-template #content let-activateCallback="activateCallback"
                         let-value="value">
              <button
                (click)="activateCallback()"
                class="bg-transparent cursor-pointer border-0 inline-flex flex-col gap-2">
                    <span
                      [ngClass]="{
                                'bg-primary text-primary-contrast border-primary': value <= activeStep,
                                'border-surface': value > activeStep
                            }"
                      class="rounded-full border-2  w-8 h-8 inline-flex items-center justify-center"

                    >
                        <i class="pi pi-shopping-cart"></i>
                    </span>
              </button>
            </ng-template>
          </p-step>

        </p-step-list>


        <p-step-panels>
          <!--          Primeiro painel-->
          <p-step-panel [formGroup]="appointmentForm" [value]="1">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="h-[32.8rem]">
                <div class="flex flex-col gap-4 w-3/4">
                  <div
                    class="flex flex-col font-medium gap-0.5 w-full">
                    <label for="date">Data</label>
                    <p-datepicker
                      [showIcon]="true"
                      inputId="date"
                      size="small"
                      formControlName="date"
                      [readonlyInput]="true"
                      [minDate]="minDate"
                      [maxDate]="maxDate"
                    ></p-datepicker>

                  </div>

                  <div class="flex flex-col gap-1 ">
                    <label class="font-semibold">Horários</label>
                    <p-select-button
                      [options]="hours"
                      class="grid! grid-cols-3! gap-3  bg-transparent!"
                      size="small"
                      formControlName="hour"
                    >
                      <ng-template #item let-item>
                        <div>
                    <span>
                      {{ item.hour }}
                    </span>
                        </div>
                      </ng-template>

                    </p-select-button>
                  </div>

                  <div class="flex flex-col gap-1">
                    <label class="font-semibold"
                           for="clientSelect">Cliente</label>
                    <p-select
                      formControlName="client"
                      [filter]="true"
                      [options]="clients()"
                      [showClear]="true"
                      filterBy="fullName"
                      placeholder="Selecione um cliente"
                      size="small"
                      (onChange)="onClientSelected($event.value)"
                    >
                      <ng-template #selectedItem let-selectedOption>
                        <div
                             class="flex items-center gap-2">
                          <div
                            class="h-[30px] w-[30px] rounded-full border border-primary-200 overflow-hidden">
                            <img class="w-full object-cover"
                                 [src]="selectedOption.photo" alt="">
                          </div>
                          <p>
                            {{selectedOption.fullName}}
                          </p>

                        </div>

                      </ng-template>
                      <ng-template #item let-client>
                        <div class="flex items-center gap-2">
                          <div
                            class="h-[30px] w-[30px] rounded-full border border-primary-400 overflow-hidden">
                            <img class="w-full object-cover"
                                 [src]="client.photo" alt="">

                          </div>
                          <p>
                            {{client.fullName}}
                          </p>

                        </div>
                      </ng-template>
                    </p-select>
                  </div>

                  <p-button (onClick)="activateCallback(2)"
                            icon="pi pi-plus-circle"
                            iconPos="right"
                            label="Adicionar serviços"
                            severity="secondary"
                            size="small"
                            styleClass="absolute! bottom-5! right-5! bg-primary! text-primary-contrast!"
                            [disabled]="!formValidated()"

                  />
                </div>
              </div>
            </ng-template>
          </p-step-panel>
          <p-step-panel [value]="2">
            <ng-template #content let-activateCallback="activateCallback">
              <div class="h-[35rem] ">
                <h1
                  class="font-semibold text-xl text-muted-color-emphasis mb-5">
                  Serviços</h1>

                <div class="overflow-y-auto flex gap-3 flex-col">
                  @for (service of serviceItems; track service.id) {
                    <app-service-item-form
                      (click)="addServiceToCar(service)"
                      [titleService]="service.name"
                      [priceService]="service.price"
                    />
                  }
                </div>
              </div>
            </ng-template>
          </p-step-panel>


        </p-step-panels>
      </p-stepper>
    </div>
    <div class="flex flex-col gap-8 ">
      <app-profile-preview-form
        [nameClient]="clientSelected()?.fullName ?? null"
        [profileImagePreviewInput]="clientSelected()?.photo ?? null"
        [numberClient]="clientSelected()?.phoneNumber ?? null"
        [observationClient]="clientSelected()?.observation ?? null"

      />
      <div>
        <app-summary-services-form
          [services]="chosenServiceItems"
          class="h-full"
        />
      </div>
    </div>
  </div>


</p-dialog>
